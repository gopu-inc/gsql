name: üê≥ Publication Docker

on:
  push:
    branches: main

jobs:
  docker:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4
      
      - name: üè∑Ô∏è Lire version du tag
        id: version
        run: |
          VERSION="${GITHUB_REF#refs/tags/v}"
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "üì¶ Version Docker: $VERSION"
      
      - name: üê≥ Login Docker Hub
        uses: docker/login-action@v3
        with:
          username: ceoseshell
          password: ${{ secrets.DOCKER_PASSWORD }}
      
      - name: üê≥ Build & Push
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: |
            ceoseshell/gsql:latest
            ceoseshell/gsql:${{ env.VERSION }}
          labels: |
            version=${{ env.VERSION }}
            org.opencontainers.image.source=https://github.com/${{ github.repository }}
