name: ğŸ“¦ Publication Anaconda
on:
  push:
    tags:
      - 'v*'

jobs:
  conda:
    runs-on: ubuntu-latest
    # Retirez la section 'defaults' pour Ã©viter tout conflit de shell

    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ Setup Miniconda (Version stable)
        uses: conda-incubator/setup-miniconda@v3
        with:
          # Configuration minimale et stable
          auto-activate-base: true
          # NE PAS utiliser 'activate-environment' pour Ã©viter les conflits
          miniconda-version: "latest"

      - name: ğŸ“¦ Installer conda-build et anaconda-client
        # Assurez-vous que conda est bien dans le PATH
        run: |
          conda install -y -c conda-forge conda-build anaconda-client
          conda --version
          conda-build --version

      - name: ğŸ” VÃ©rifier le meta.yaml existant
        run: |
          echo "ğŸ” VÃ©rification du meta.yaml..."
          # ... (le reste de votre code pour vÃ©rifier/mettre Ã  jour meta.yaml) ...

      - name: ğŸ—ï¸ Construire le package Conda
        run: |
          echo "ğŸ—ï¸ Construction du package..."
          conda build conda.recipe/ --output-folder conda_pkg
          # ... (suite du build) ...

      - name: ğŸš€ Upload vers Anaconda.org
        run: |
          PKG_FILE=$(find conda_pkg -name "*.tar.bz2" -type f | head -1)
          if [ -n "$PKG_FILE" ]; then
            anaconda -t ${{ secrets.ANACONDA_TOKEN }} upload --user ceoseshell "$PKG_FILE"
          fi
